# ============================================================================
# MODULE 1: ANTI-PATTERN - Sequential Pipeline (The "Before" State)
# ============================================================================
# This config demonstrates what NOT to do. Every job waits for the previous
# one, even when there's no real dependency. We reinstall deps in every job.
#
# PAIN POINTS TO OBSERVE IN CIRCLECI UI:
#   - Total time = sum of all jobs (no parallelism)
#   - Each job reinstalls node_modules (~30-60 sec wasted per job)
#   - Pipeline visualization shows a straight line, not a diamond
# ============================================================================

version: 2.1

jobs:
  build:
    docker:
      - image: cimg/node:20.18
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: npm ci
      - run:
          name: Build application
          command: npm run build

  lint:
    docker:
      - image: cimg/node:20.18
    steps:
      - checkout
      - run:
          name: Install dependencies (again!)
          command: npm ci    # WASTE: Already installed in build
      - run:
          name: Run linter
          command: npm run lint

  test-unit:
    docker:
      - image: cimg/node:20.18
    steps:
      - checkout
      - run:
          name: Install dependencies (again!)
          command: npm ci    # WASTE: Third time installing
      - run:
          name: Run unit tests
          command: npm run test:unit

  test-integration:
    docker:
      - image: cimg/node:20.18
    steps:
      - checkout
      - run:
          name: Install dependencies (again!)
          command: npm ci    # WASTE: Fourth time
      - run:
          name: Run integration tests
          command: npm run test:integration

  test-e2e:
    docker:
      - image: cimg/node:20.18
    steps:
      - checkout
      - run:
          name: Install dependencies (again!)
          command: npm ci    # WASTE: Fifth time!
      - run:
          name: Run E2E tests
          command: npm run test:e2e

# ============================================================================
# WORKFLOW: Everything runs sequentially - SLOW!
# ============================================================================
workflows:
  m1-sequential-anti-pattern:
    jobs:
      - build:
          filters:
            branches:
              only:
                - main
                - /feature\/.*/

      # ANTI-PATTERN: lint waits for build, but doesn't need build output
      - lint:
          requires:
            - build

      # ANTI-PATTERN: These tests don't depend on each other, yet run sequentially
      - test-unit:
          requires:
            - lint

      - test-integration:
          requires:
            - test-unit

      - test-e2e:
          requires:
            - test-integration

# ============================================================================
# WHAT'S WRONG HERE (Module 1 Learning Points):
#
# 1. FALSE DEPENDENCIES: lint doesn't need build output - just source code
# 2. NO PARALLELISM: All test jobs could run at the same time
# 3. NO WORKSPACE: npm ci runs 5 times instead of once
# 4. TOTAL TIME: ~6-8 min sequential vs ~2-3 min with fan-out
#
# Next config (02) shows the fix using fan-out/fan-in patterns.
# ============================================================================
